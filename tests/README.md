# テスト・デバッグスクリプト集

このフォルダーには、開発中のデバッグやトラブルシューティングに使用するスクリプトが含まれています。

---

## 📧 メール関連のデバッグ

### `debug_mail_content.py`

Outlookの「Teams日報」フォルダー内のメール内容を詳細に表示します。

**用途:**
- メール本文に `#日報` タグが正しく含まれているか確認
- メールの受信日時、送信日時を確認
- `#日報` タグの出現回数をカウント

**実行方法:**
```powershell
python tests\debug_mail_content.py
```

**出力例:**
```
メール件数: 3
================================================================================

--- メール 1 ---
件名: チームメンバー: Microsoft Teams でのチャットの会話
差出人: YAMADA Taro 山田 太郎
受信日時: 2025-12-24 09:57:56
...
本文全体（582文字）:
...
#日報の出現回数: 2回
```

**トラブルシューティング:**
- メールが取得できない → Outlookフォルダー名を確認
- タグが見つからない → メール本文の形式を確認

---

### `list_outlook_folders.py`

Outlookの受信トレイ配下のフォルダ一覧を表示します。

**用途:**
- Outlookフォルダーの構造を確認
- 「Teams日報」フォルダーが正しく作成されているか確認
- メール件数の確認

**実行方法:**
```powershell
python tests\list_outlook_folders.py
```

**出力例:**
```
受信トレイ: 受信トレイ
============================================================
- Teams日報 (Count: 3)
- プロジェクトA (Count: 10)
  - サブフォルダ1 (Count: 5)
- 保存用 (Count: 20)
============================================================
```

**トラブルシューティング:**
- フォルダーが見つからない → Outlookアプリで受信トレイを確認
- 件数が0 → メールを「Outlookで共有」したか確認

---

### `debug_mapi_properties.py`

メールのMAPIプロパティを詳細に調査します（高度なデバッグ用）。

**用途:**
- メールのメタデータを詳しく調査
- タイムスタンプ情報の探索
- MAPIプロパティの確認

**実行方法:**
```powershell
python tests\debug_mapi_properties.py
```

**注意:**
- このスクリプトは通常の運用では不要です
- MAPIプロパティの調査用に作成されました

---

## 📝 日報抽出ロジックのテスト

### `test_extract.py`

`extract_daily_reports()` 関数の動作をテストします。

**用途:**
- 正規表現パターンのマッチング確認
- タグ抽出ロジックのデバッグ
- 日付付きタグと日付なしタグの両方をテスト

**実行方法:**
```powershell
python tests\test_extract.py
```

**出力例:**
```
================================================================================
入力テキスト:
...
#日報計画 (日付付き): 0件
#日報結果 (日付付き): 0件
#日報 (日付付き): 0件
#日報 (全て): 1件
  - マッチ: '#日報 ログ保存先不具合対応 ...'
    要約: 'ログ保存先不具合対応'
    → 採用
```

**使い方:**
- テストケースを追加する場合は、スクリプト内の `test_text` を編集
- 新しいタグパターンを試す際に使用

---

## 📊 Excel関連のデバッグ

### `test_excel_read.py`

Excelファイルから日付とシート情報を読み込んでテストします。

**用途:**
- Excelファイルのパスが正しいか確認
- シート名の検索ロジックを確認
- 日付列（B列）のデータ型を確認
- 指定日付の行番号を検索

**実行方法:**
```powershell
python tests\test_excel_read.py
```

**注意:**
- **実行前にExcelファイルを閉じてください**
- スクリプト内の `EXCEL_PATH` を環境に合わせて修正してください

**出力例:**
```
★ 重要: Excelファイルを閉じてから実行してください ★

全シート一覧: ['実施申請・報告書（2025年12月）', ...]
対象シート: 実施申請・報告書（2025年12月）
...
日付検索テスト:
  2025-12-01 → 行 24
  2025-12-02 → 行 32
```

---

### `check_excel_dates.py`

Excel日報ファイルの日付列をチェックします。

**用途:**
- 日付列の全データを表示
- 今日の日付がExcelに存在するか確認
- データ型（datetime、数値、文字列）の確認

**実行方法:**
```powershell
python tests\check_excel_dates.py
```

**注意:**
- スクリプト内の `EXCEL_PATH` を環境に合わせて修正してください

---

### `debug_excel_dates.py`

Excelファイルの日付データの詳細をデバッグします。

**用途:**
- セルの値の詳細確認（型、値、フォーマット）
- 特定の日付行の探索
- data_only パラメータの動作確認

**実行方法:**
```powershell
python tests\debug_excel_dates.py
```

---

## 🔧 スクリプトの使い分け

| 問題 | 使用するスクリプト |
|------|-------------------|
| メールが取得できない | `debug_mail_content.py` |
| タグが抽出できない | `test_extract.py` |
| Excelファイルが見つからない | `test_excel_read.py` |
| 日付行が見つからない | `test_excel_read.py` または `check_excel_dates.py` |
| 日付のデータ型がおかしい | `debug_excel_dates.py` |
| 同じ内容が重複して書き込まれる | `debug_mail_content.py` |

---

## 📝 よくある質問

### Q: これらのスクリプトは本番運用で必要ですか？

A: いいえ、本番運用では `src\teams_chat_from_outlook.py` のみを使用します。これらのスクリプトはトラブルシューティング専用です。

### Q: スクリプトを実行してもエラーが出ます

A: 各スクリプト内の以下の設定を環境に合わせて変更してください：
- `OUTLOOK_FOLDER` - Outlookフォルダー名
- `EXCEL_PATH` - Excelファイルのパス
- `DATE_COL` - 日付列（通常はB列）

### Q: 新しいテストスクリプトを追加したい

A: このフォルダーに追加してください。ファイル名は `test_*.py` または `debug_*.py` の形式を推奨します。

---

## 🚀 開発者向け情報

### スクリプトの命名規則

- `test_*.py` - 機能テスト（ロジックの動作確認）
- `debug_*.py` - デバッグ用（データの詳細表示）
- `check_*.py` - 状態確認用（データの存在確認）

### 依存パッケージ

これらのスクリプトは、メインプロジェクトと同じ依存パッケージを使用します：
- `pywin32==311` - Outlook COM自動化
- `openpyxl` - Excel読み書き

### 注意事項

- これらのスクリプトはExcelファイルを**読み取り専用**で開きます（一部を除く）
- 本番データを壊すことはありませんが、実行前に確認してください
- スクリプトによってはOutlookやExcelを閉じる必要があります
